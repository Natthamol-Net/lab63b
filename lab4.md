# การทดลองที่ 4 เรื่อง การเขียนโปรแกรมอินพุทสัญญาณดิจิทัล

## วัตถุประสงค์
1.	เพื่อศึกษาการรันโปรแกรม Input ที่มาจากภายนอกเข้ามาภายในตัว Microcontroller 
2.	เพื่อนำ Microcontroller ที่ถูกเขียนโปรแกรมแล้วไปประยุกต์ใช้กับอุปกณ์อื่น 

## อุปกรณ์ที่ใช้
1.	Microcontroller (ESP01) 
2.	อุปกรณ์เชื่อมต่อ USB (USB to Serial)
3.	Adapter ที่ต่อด้วยสาย Port 0 (สายสีขาว) กับสาย Port 2 (สายสีเหลือง)
4.	หลอดไฟ LED
5.	เซ็นเซอร์แสงที่ต่ออยู่กับตัวต้านทาน

## ศึกษาข้อมูลเบื้องต้น
1. 04 run example 4 : https://youtu.be/nFqoZT26U5k
2. src code ของตัวอย่างโปรแกรม 04_Input-Port : https://github.com/choompol-boonmee/lab63b/blob/master/examples/04_Input-Port/src/main.cpp


## วิธีการทำการทดลอง
1. เสียบตัว Adapter เข้ากับ USB to Serial แล้วค่อยเสียบตัวMicrocontroller บน Adapter

![รูป]()

2.ดูตัวอย่างโปรแกรมที่โฟลเดอร์ pattani
- พิมพ์ **cd pattani** เพื่อเข้าไปในโฟลเดอร์ 

3.เลือกใช้โปรแกรมตัวอย่างที่ 4
- พิมพ์ **cd 04_Input-Port**
- พิมพ์ **vi src/main.cpp** เพื่อดูเนื้อหาในโปรแกรม จะขึ้นข้อมูลดังนี้
```javascript
#include <Arduino.h>
#include <ESP8266WiFi.h>

int cnt = 0;

void setup()
{
	Serial.begin(115200);
	pinMode(0, INPUT);
	pinMode(2, OUTPUT);
	Serial.println("\n\n\n");
}

void loop()
{
	int val = digitalRead(0);
	Serial.printf("======= read %d\n", val);
	if(val==1) {
		digitalWrite(2, LOW);
	} else {
		digitalWrite(2, HIGH);
	}
	delay(100);
}
```
จากโปรแกรมที่ 4 จะแสดงข้อมูลแบ่งเป็น 2 ส่วนคือ 
- ส่วน set up โปรแกรมจะ set ให้ Port 0 (สายสีขาว) เป็น Port Input และ Port 2 (สายสีเหลือง) เป็น Port Output
- ส่วน loop โปรแกรมจะสั่งให้วนลูป อ่านข้อมูลจาก Port 0 ข้อมูลที่อ่านได้จะเป็นสัญญาณดิจิตอล (แสดงผล 0 หรือ 1) ถ้าแสดงผลเป็น 1 ให้ LOW ไปที่ Port 2 คือหลอดไฟ LED จะดับ ถ้าแสดงผลเป็น 0 ให้ HIGH ไปที่ Port 2 คือหลอดไฟ LED จะติด


4. ทำการ upload โปรแกรม 04_Input-Port เข้าไปยัง Microcontroller โดยการพิมพ์คำสั่ง **pio run -t upload** เพื่อรันโปรแกรม
ขณะที่รันโปรแกรม ให้กดปุ่มอัพโหลด (สีดำ) และ ปุ่มรีเซ็ต (สีแดง) บน Serial port เพื่อให้ Microcontroller รับโปรแกรมใหม่เข้าไป

![รูป]()

5. เมื่อโปรแกรมอัพโหลดเสร็จจะแสดงผลลัพธ์โดย พิมพ์คำสั่ง **pio device monitor** จะแสดงผลได้ดังรูป

![รูป]()

6. นำสายไฟเส้นสีขาว (Port 0)  ไปจิ้มเข้าช่องเดียวกันกับสายสีดำที่ให้สัญญาณ Input เป็น 0  Output ที่ได้จะแสดงผล read 0 (ไฟติด) ถ้านำไปจิ้มเข้าช่องเดียวกันกับสายสีแดงที่ให้สัญญาณ Input เป็น 1 Output ที่ได้จะแสดงผล read 1 (ไฟไม่ติด)

![รูป]()

7.เมื่อกดปุ่มอัพโหลด จะทำให้ Port 0 เป็น read 0 (ไฟติด) ถ้าไม่กดปุ่ม Port 0 จะเป็น read 1 (ไฟไม่ติด)

![รูป]()

8. นำขาของตัวต้านทานที่ไม่ได้ต่อกับเซ็นเซอร์แสง มาต่อเข้ากับไฟเลี้ยง 3 V.(ตรงสายสีแดง) และนำขาที่เซ็นเซอร์แสงต่ออยู่กับตัวต้านทาน มาต่อเข้าไปใน Port 0 ส่วนขาที่เหลือต่อเข้ากับเส้นสีดำ(Ground) และนำสายไฟเส้นสีขาว (Input) ไปต่อเข้ากับ Port 0 

![รูป]()

9. เมื่อนำหน้าเซ็นเซอร์แสง โดนแสงสว่าง Output จะแสดงผล read 0 (ไฟติด) แต่ถ้านำนิ้วไปปิดหน้าเซ็นเซอร์แสง ไม่ให้โดนแสง Output จะแสดงผล read 1 (ไฟไม่ติด)


![รูป]()



## การบันทึกผลการทดลอง
1. เมื่ออัพโหลดโปรแกรมลงบน Microcontroller เสร็จแล้ว พิมพ์ pio device monitor เพื่อแสดงผลโปรแกรมและสังเกตุผลจากการส่องสว่างของหลอด LED จะเห็นว่า
เมื่อนำสายไฟเส้นสีขาว (Port 0) ไปจิ้มเข้าช่องเดียวกันกับสายสีดำที่ให้สัญญาณ Input เป็น 0 Output ที่ได้จะแสดงผล read 0 (ไฟติด)
ถ้านำไปจิ้มเข้าช่องเดียวกันกับสายสีแดงที่ให้สัญญาณ Input เป็น 1 Output ที่ได้จะแสดงผล read 1 (ไฟไม่ติด)
และเมื่อกดปุ่มอัพโหลด จะทำให้ Port 0 แสดงผลเป็น read 0 (ไฟติด) ถ้าไม่กดปุ่ม Port 0 จะแสดงผลเป็น read 1 (ไฟไม่ติด) เพราะปุ่มอัพโหลดถูกต่อเข้าอยู่กับ Port 0
2. เมื่อนำ Microcontroller มาต่อเข้ากับเซ็นเซอร์แสง จะเห็นว่าหน้าเซ็นเซอร์แสงที่โดนแสงสว่าง ไฟจะติด แต่ถ้านำนิ้วไปปิดหน้าเซ็นเซอร์แสงไม่ให้โดนแสง ไฟจะดับ


## อภิปรายผลการทดลอง
จากการทดลองเขียนโปรแกรมอินพุทสัญญาณดิจิทัล โดยเลือกโปรแกรม 04_Input-Port มาเขียน โดยผลลัพธ์ที่แสดงออกมาจะดูได้จาก Input ที่ Port 0 ถ้า Input เป็น 1 ไฟจะติด และถ้า Input เป็น 0 ไฟจะดับ ดังนั้น สัญญาณ Input จาก Port 0 จะเป็นตัวควบคุมการติด - ดับของหลอดไฟ และเมื่อนำตัว Microcontroller ที่ถูกเขียนโปรแกรมแล้ว ไปต่อเข้ากับเซ็นเซอร์แสง จะสังเกตุได้ว่าถ้าเอานิ้วไปปิดหน้าเซ็นเซอร์แสงไม่ให้โดนแสง จะทำให้ค่า Input เป็น 1 ไฟจะดับ และเมื่อไม่มีอะไรมาบังเซ็นเซอร์แสง จะทำให้ค่า Input เป็น 0 ไฟจะติด

## คำถามหลังการทดลอง
 



